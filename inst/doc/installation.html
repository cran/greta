<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Installing Dependencies</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Installing Dependencies</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(greta)</span></code></pre></div>
<div id="why-we-need-to-install-dependencies" class="section level1">
<h1>Why we need to install dependencies</h1>
<p>The greta package uses Google’s <a href="https://www.tensorflow.org/">TensorFlow (TF)</a> and <a href="https://github.com/tensorflow/probability">Tensorflow Probability
(TFP)</a>) under the hood to do efficient, fast, and scalable linear
algebra and MCMC. TF and TFP are python packages, and so are required to
be installed. This is different to how normal dependencies work with R
packages, where the dependencies are automagically built and managed by
CRAN.</p>
<p>Unfortunately, there isn’t an automatic, reliable way to ensure that
these are provided along when you install greta, so we need to take an
additional step to install them. We have tried very hard to make the
process as easy as possible by providing a helper function,
<code>install_greta_deps()</code>.</p>
</div>
<div id="how-to-install-python-dependencies-using-install_greta_deps" class="section level1">
<h1>How to install python dependencies using
<code>install_greta_deps()</code></h1>
<p>We recommend running:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">install_greta_deps</span>()</span></code></pre></div>
<p>And then following any prompts to install dependencies. You will then
need to restart R and load <code>library(greta)</code> to start using
greta.</p>
</div>
<div id="how-install_greta_deps-works" class="section level1">
<h1>How <code>install_greta_deps()</code> works</h1>
<p>The <code>install_greta_deps()</code> function installs the Python
dependencies TF and TFP. By default it installs versions TF 2.15.0, and
TFP version 0.23.0. It places these inside a conda environment,
“greta-env-tf2”. For the default settings, this is python 3.10. Using a
conda environment isolates these exact python modules from other python
installations, so only <code>greta</code> will see them.</p>
<p>We do this as it helps avoids installation issues, where previously
you might update TF on your computer and overwrite the current version
needed by <code>greta</code>. Using this “greta-env-tf2” conda
environment means installing other python packages should not be impact
the Python packages needed by <code>greta</code>. It is part of the
recommended way to <a href="https://rstudio.github.io/reticulate/articles/python_dependencies.html">manage
python dependencies in an R package</a> as recommended by the team at
Posit.</p>
<div id="using-different-versions-of-tf-tfp-and-python" class="section level2">
<h2>Using different versions of TF, TFP, and Python</h2>
<p>The <code>install_greta_deps()</code> function takes three
arguments:</p>
<ol style="list-style-type: decimal">
<li><code>deps</code>: Specify dependencies with
<code>greta_deps_spec()</code></li>
<li><code>timeout</code>: time in minutes to wait in installation before
failing/exiting</li>
<li><code>restart</code>: whether to restart R (“force” - restart R,
“no”, will not restart, “ask” (default) - ask the user)</li>
</ol>
<p>You specify the version of TF TFP, or python that you want to use
with <code>greta_deps_spec()</code>, which has arguments:</p>
<ul>
<li><code>tf_version</code></li>
<li><code>tfp_version</code></li>
<li><code>python_version</code></li>
</ul>
<p>If you specify versions of TF/TFP/Python that are not compatible with
each other, it will error before starting installation. We determined
the appropriate versions of Python, TF, and TFP from <a href="https://www.tensorflow.org/install/source#tested_build_configurations" class="uri">https://www.tensorflow.org/install/source#tested_build_configurations</a>
and <a href="https://www.tensorflow.org/install/source_windows#tested_build_configurations" class="uri">https://www.tensorflow.org/install/source_windows#tested_build_configurations</a>,
and by inspecting TFP release notes. We put this information together
into a dataset, <code>greta_deps_tf_tfp</code>. You can inspect this
with <code>View(greta_deps_tf_tfp)</code>.</p>
<p>If you provide an invalid installation versions, it will error and
suggest some alternative installation versions.</p>
</div>
<div id="how-we-install-dependencies" class="section level2">
<h2>How we install dependencies</h2>
<p>For users who want to know more about the installation process of
dependencies in greta.</p>
<p>We create a separate R instance using <a href="https://callr.r-lib.org/index.html"><code>callr</code></a> to
install python dependencies using <code>reticulate</code> to talk to
Python, and the R package <code>tensorflow</code>, for installing the
tensorflow python module. We use <code>callr</code> so that we can
ensure the installation of python dependencies happens in a clean R
session that doesn’t have python or reticulate already loaded. It also
means that we can hide the large amounts of text output to the console
that happens when installation is running - these are written a logfile
during installation that you can read with
<code>open_greta_install_log()</code>.</p>
<p>If miniconda isn’t installed, we install miniconda. You can think of
miniconda as a lightweight version of python with minimal
dependencies.</p>
<p>If “greta-tf2-env” isn’t found, then we create a new conda
environment named “greta-tf2-env”, for a version of python that works
with the specified versions of TF and TFP.</p>
<p>Then we install the TF and TFP python modules, using the versions
specified in <code>greta_deps_spec()</code>.</p>
<p>After installation, we ask users if they want to restart R. This only
happens in interactive sessions, and only if the user is in RStudio.
This is to avoid potential issues where this script might be used in
batch scripts online.</p>
</div>
<div id="troubleshooting-installation" class="section level2">
<h2>Troubleshooting installation</h2>
<p>Installation doesn’t always go to plan. Here are some approaches to
getting your dependencies working.</p>
<ul>
<li>Check you have restarted R after installing dependencies
<ul>
<li>After you have installed dependencies with
<code>install_greta_deps()</code>, you will be prompted to restart R. To
use greta you must restart R after installing dependencies as this
allows greta to connect to the installed python dependencies.</li>
</ul></li>
<li>Use <code>greta_sitrep()</code> to check dependencies.
<ul>
<li><code>greta_sitrep()</code> will provide information about your
installed version of Python, TF, TFP, and whether a conda environment is
used. This can be helpful to troubleshoot some installation issues.</li>
</ul></li>
<li>Check the installation logfile
<ul>
<li>During installation we write a logfile, which records all of the
steps taken during installation. This can sometimes provide useful clues
as to what might have gone awry during installation. You can open the
logfile with <code>open_greta_install_log()</code>, which opens the
logfile in a browser window, and scroll through it to try and find
errors or things that went wrong during installation. We recommend
viewing this with <code>open_greta_install_log()</code> and then
searching with Ctrl/Cmd+F for things like “error/Error/ERROR/warn/etc”
to find problems. There might not be a clear solution to the problem,
but the logfile might provide clues to the problem that you can share on
a forum or issue on the greta github.</li>
</ul></li>
<li>Reinstall greta dependencies with
<code>reinstall_greta_deps()</code>
<ul>
<li>Sometimes we just need to “turn it off and on again”. Use
<code>reinstall_greta_deps()</code> to remove miniconda, and the greta
conda environment, and install them again.</li>
</ul></li>
<li>Manually remove python installation
<ul>
<li>You can manually remove python installation by doing:
<ul>
<li><code>remove_greta_env()</code></li>
<li><code>remove_miniconda()</code></li>
<li>or <code>destroy_greta_deps()</code>, which does both of these
steps.</li>
</ul></li>
<li>Then install the dependences with: <code>install_greta_deps()</code>
<ul>
<li>Note that this is functionally what
<code>reinstall_greta_deps()</code> does, but sometimes it can be useful
to separate them out into separate steps.</li>
</ul></li>
</ul></li>
<li>Check internet access
<ul>
<li>Installing these dependencies requires an internet connection, and
sometimes the internet service provider (perhaps IT?) blocks websites
like conda from downloading. In the past we have encountered this issue
and have found that it can be avoided by doing re-installation with
<code>reinstall_greta_deps()</code>.</li>
</ul></li>
</ul>
<p>If the previous installation helper did not work, you can try the
following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">install_miniconda</span>()</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">conda_create</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>        <span class="at">envname =</span> <span class="st">&quot;greta-env-tf2&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        <span class="at">python_version =</span> <span class="st">&quot;3.10&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>      )</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">conda_install</span>(</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        <span class="at">envname =</span> <span class="st">&quot;greta-env-tf2&quot;</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>        <span class="at">packages =</span> <span class="fu">c</span>(</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>          <span class="st">&quot;tensorflow-probability==0.23.0&quot;</span>,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>          <span class="st">&quot;tensorflow==2.15.0&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        )</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>      )</span></code></pre></div>
<p>Which will install the python modules into a conda environment named
“greta-env-tf2”.</p>
<p>You can also not install these not into a special conda environment
like so:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">install_miniconda</span>()</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">conda_install</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>        <span class="at">packages =</span> <span class="fu">c</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>          <span class="st">&quot;tensorflow-probability==0.23.0&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>          <span class="st">&quot;tensorflow==2.15.0&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>        )</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>      )</span></code></pre></div>
<!-- You can also use `install_tensorflow()` to install different versions of TensorFlow, including versions with GPU acceleration. If you're having trouble with this step, [this guide](https://tensorflow.rstudio.com/installation/) may help. -->
<hr>
<!-- You can also use `install_tensorflow()` to install different versions of TensorFlow, including versions with GPU acceleration. If you're having trouble with this step, [this guide](https://tensorflow.rstudio.com/installation/) may help. -->
<!-- If you want `greta` to run as fast as possible on your computer's CPUs, it would be worth installing python and TensorFlow using Anaconda since they will be automatically configured to use Intel's MKL routines, which provide a 2-8 fold sampling speedup on most models. -->
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
